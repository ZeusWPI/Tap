<div class="columns is-multiline">
  <!-- Select Product -->
  <div class="column">
    <div class="order-new-actions">
      <!-- Title -->
      <div class="order-new-actions-title">
        <% if current_user.koelkast %>
          <div class="back is-size-5">
            <%= link_to "Go back", root_path %>
          </div>
          Place an order for <%= @user.name %>
        <% else %>
          Place an order
        <% end %>
      </div>

      <!-- Barcode Field (for Koelkast) -->
      <% if current_user.koelkast %>
        <%= form_tag nil do %>
          <input
            class="order-new-actions-barcode input is-large"
            placeholder="Scan a barcode"
            autofocus="true"
            autocomplete="off"
          />
        <% end %>

        <div class="order-new-actions-or">
          - OR -
        </div>
      <% end %>

      <!-- Product Select -->
      <button class="button is-primary is-large" data-modal-open="productsModal">
        <%= icon('fas', 'list', class: "mr-3") %> Select product
      </button>


      <!-- Barcode Scanner (for users) -->
      <% if !current_user.koelkast %>
        <div class="order-new-actions-or">
          - OR -
        </div>

        <div>
          <button class="button is-primary is-large">
            <%= icon('fas', 'camera', class: "mr-3") %> Scan barcode
          </button>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Bill -->
  <div class="column is-12 is-7-tablet is-4-desktop">
    <%= f_form_for [@user, @order] do |f| %>
      <div class="order-new-bill">
        <!-- Logo -->
        <div class="order-new-bill-logo is-hidden-mobile">
          <%= image_tag "logo.png", alt: "Logo", class: "theme-blend" %>
        </div>

        <!-- Title -->
        <h1 class="order-new-bill-title is-hidden-desktop">
          Your order
        </h1>

        <!-- Errors -->
        <%= f.error_messages %>

        <!-- Overview -->
        <div class="order-new-bill-overview">
          <hr />

          <!-- Items -->
          <table class="order-new-bill-items">
            <thead>
              <tr>
                <th>Quantity</th>
                <th>Product</th>
                <th class="has-text-right">Subtotal</th>
                <th></th>
              </tr>
            </thead>

            <%= f.fields_for :order_items do |ff| %>
              <tr
                id="orderItem"
                class="order-new-bill-item is-hidden"
                data-order-product-id="<%= ff.object.product.id %>"
                data-order-product-price="<%= ff.object.product.price_cents %>"
              >
                <%= ff.hidden_field :product_id %>

                <td>
                  <%=
                    ff.number_field :count,
                    id: "orderItemQuantity",
                    class: "order-new-bill-input input is-small",
                    skip_label: true
                  %>
                </td>

                <td>
                  <%= ff.object.product.name %>
                </td>

                <td class="has-text-right" id="orderItemSubtotal" data-order-product-subtotal="<%= ff.object.product.price_cents * ff.object.count %>">
                  <%= euro_from_cents(ff.object.product.price_cents * ff.object.count) %>
                </td>

                <td>
                  <div class="button is-danger is-light" data-order-product-delete="<%= ff.object.product.id %>">
                    <%= icon('fas', 'trash-alt') %>
                  </div>
                </td>
              </tr>
            <% end %>
          </table>

          <!-- Placeholder -->
          <div class="order-new-bill-placeholder" id="orderPlaceholder">
            No products selected yet.
          </div>

          <hr />

          <!-- Total -->
          <div class="order-new-bill-overview-total">
            <strong>Total:</strong>
            <span id="orderTotal">
              <%= euro_from_cents(0) %>
            </span>
          </div>
        </div>

        <!-- Actions -->
        <%= f.submit "Place order", class: "button is-primary is-fullwidth", data: { disable_with: "Please wait..." } %>
      </div>
    <% end %>
  </div>
</div>

<%= render "products_modal" %>
